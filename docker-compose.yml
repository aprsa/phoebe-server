services:
  phoebe-lab-server:
    build:
      context: .
      dockerfile: Dockerfile
    image: phoebe-lab-server:latest
    container_name: phoebe-lab-server
    restart: unless-stopped
    environment:
      - PHOEBE_ENABLE_ONLINE_PASSBANDS=FALSE
      - PHOEBE_PBDIR=/etc/phoebe/atmospheres/tables/passbands
      # Set JWT secret for production (required for jwt/external auth modes):
      # - PHOEBE_JWT_SECRET_KEY=<your-secret-here>
    ports:
      - "8001:80"
    volumes:
      - ./config.toml:/etc/phoebe-server/config.toml:ro
      - ~/.phoebe/atmospheres/tables/passbands:/etc/phoebe/atmospheres/tables/passbands:ro
      - ./data:/app/data
    networks:
      - phoebe-lab-net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    deploy:
      resources:
        limits:
          memory: 120G
        reservations:
          memory: 1G

networks:
  phoebe-lab-net:
    name: phoebe-lab-net
    driver: bridge
