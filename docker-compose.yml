services:
  phoebe-lab-server:
    build:
      context: .
      dockerfile: Dockerfile
    image: phoebe-lab-server:latest
    container_name: phoebe-lab-server
    restart: unless-stopped
    environment:
      - PHOEBE_ENABLE_ONLINE_PASSBANDS=FALSE
      - PHOEBE_PBDIR=/etc/phoebe/atmospheres/tables/passbands
    ports:
      # Map host port to container port 80
      # Change the left side to your desired external port
      - "8001:80"
    volumes:
      # Mount user config (required)
      - ./config.toml:/app/config.toml:ro
      # Persist database
      - phoebe-data:/app/data
      # Passband data
      - ~/.phoebe/atmospheres/tables/passbands:/etc/phoebe/atmospheres/tables/passbands:ro
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    deploy:
      resources:
        limits:
          memory: 120G
        reservations:
          memory: 1G

volumes:
  phoebe-data:
    driver: local
